
<!DOCTYPE html>
<html lang="en">
<head>
    <title>Legacy Voices - Record Responses</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <h1>Legacy Voices - Record Your Answers</h1>

    <div id="questionContainer">
        <p id="questionText" style="font-weight: bold; font-size: 1.2em; margin: 15px 0;"></p>
    </div>

    <textarea id="responseText" rows="5" cols="50"></textarea><br>
    <button onclick="stopRecordingQuestion()">⏹️ Stop Recording</button>
    <button onclick="nextQuestion()">Next Question</button>

    <script>
        let questions = JSON.parse(sessionStorage.getItem('questions'));
        let responses = JSON.parse(sessionStorage.getItem('responses')) || [];
        let questionIndex = responses.length;

        if (!questions || questions.length !== 5) {
            alert('No questions found or incorrect number. Please start from the beginning.');
            window.location.href = 'questions.html';
        }

        let recognition;
        let finalTranscript = responses[questionIndex] || '';

        document.getElementById('responseText').value = finalTranscript;

        function displayQuestion() {
            document.getElementById('questionText').innerText = questions[questionIndex];
        }

        function startRecordingQuestion() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.interimResults = true;
            recognition.lang = 'en-US';

            recognition.onresult = (event) => {
                let interimTranscript = '';
                for (let i = event.resultIndex; i < event.results.length; ++i) {
                    if (event.results[i].isFinal) {
                        finalTranscript += event.results[i][0].transcript + ' ';
                    } else {
                        interimTranscript += event.results[i][0].transcript;
                    }
                }
                document.getElementById('responseText').value = finalTranscript + interimTranscript;
            };

            recognition.onend = () => {
                setTimeout(() => {
                    if (recognition) {
                        startRecordingQuestion();
                    }
                }, 500);  // Auto-restart after pause
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                if (event.error === 'no-speech' || event.error === 'aborted') {
                    setTimeout(() => startRecordingQuestion(), 500);
                } else {
                    alert('Speech recognition error: ' + event.error);
                }
            };

            recognition.start();
        }

        function stopRecordingQuestion() {
            if (recognition) {
                recognition.stop();
                recognition = null;
            }
        }

        function nextQuestion() {
            responses[questionIndex] = document.getElementById('responseText').value.trim();
            sessionStorage.setItem('responses', JSON.stringify(responses));

            questionIndex++;
            if (questionIndex < questions.length) {
                finalTranscript = '';
                displayQuestion();
                document.getElementById('responseText').value = responses[questionIndex] || '';

                setTimeout(startRecordingQuestion, 500);

            } else {
                sessionStorage.setItem('responses', JSON.stringify(responses));
                window.location.href = 'review.html';
            }
        }

        displayQuestion();
        setTimeout(startRecordingQuestion, 500);
    </script>
</body>
</html>
